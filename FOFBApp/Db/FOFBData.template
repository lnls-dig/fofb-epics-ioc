record(waveform,"$(P)$(R)$(ACQ_NAME)ArrayDataWvf")
{
    field(DESC, "Data waveform $(ACQ_NAME)")
    field(NELM,"$(NELEMENTS)")
    field(FTVL, "LONG")
    field(TSEL, "$(P)$(R)$(ACQ_NAME)RawArrayData.TIME")
    field(FLNK, "$(P)$(R)$(ACQ_NAME)ArrayData")
}

record(subArray,"$(P)$(R)$(ACQ_NAME)ArrayData")
{
    field(DESC, "Data $(ACQ_NAME)")
    field(INP,  "$(P)$(R)$(ACQ_NAME)ArrayDataWvf NPP NMS")
    field(TSEL, "$(P)$(R)$(ACQ_NAME)RawArrayData.TIME")
    field(MALM, "$(NELEMENTS)")
    field(FTVL, "LONG")
    field(FLNK, "$(P)$(R)$(ACQ_NAME)ArrayDataSeq")
}

# Adjust NELM of subarray so clients get correct monitors when 
# number os elements change 
record(seq, "$(P)$(R)$(ACQ_NAME)ArrayDataSeq"){
field(DESC,"Get NORD from $(ACQ_NAME)$ waveform")
field(PINI,"YES")
field(DOL1, "$(P)$(R)$(ACQ_NAME)RawArrayData.NORD NPP NMS")
field(LNK1, "$(P)$(R)$(ACQ_NAME)ArrayData.NELM PP NMS")
field(SELM, "All")
}

# Offset and Gain records 

record(ao,"$(P)$(R)RtmLampCurrentOffset$(RTM_CHAN)-SP"){
  field(DTYP,"asynInt32")
  field(DESC,"set current offset")
  field(PINI,"YES")
  field(SCAN,"Passive")
  field(PREC,"3")
  field(FLNK,"$(P)$(R)$(ACQ_NAME)ConvArrayDataC$(RTM_CHAN) CPP NMS")
}

record(ao,"$(P)$(R)RtmLampCurrentGain$(RTM_CHAN)-SP"){
  field(DTYP,"asynInt32")
  field(DESC,"set current gain")
  field(PINI,"YES")
  field(SCAN,"Passive")
  field(PREC,"3")
  field(FLNK,"$(P)$(R)$(ACQ_NAME)ConvArrayDataC$(RTM_CHAN) CPP NMS)")
}

# Gain and Offset corrected waveform.
record(acalcout,"$(P)$(R)$(ACQ_NAME)ConvArrayDataC$(RTM_CHAN)")
{
  field(DESC, "gain/offset current $(ACQ_NAME)Conv")
  field(DTYP, "Soft Channel")
  field(NELM, "1000")
  field(TSEL, "$(P)$(R)$(ACQ_NAME)RawArrayData.TIME")
  field(PINI, "YES")
  field(SCAN, "Passive")
  field(INPA, "$(P)$(R)RtmLampCurrentGain$(RTM_CHAN)-SP")
  field(INPB, "$(P)$(R)RtmLampCurrentOffset$(RTM_CHAN)-SP")
  field(INAA, "$(P)$(R)GEN_$(RTM_CHAN)ArrayData.VAL CPP NMS")
  field(WAIT, "Wait")
  field(OOPT, "Every Time")
  field(CALC, "A*AA-B")
  field(OUT,  "$(P)$(R)$(ACQ_NAME)ConvArrayDataWvf$(RTM_CHAN) CA NMS")
}

record(waveform,"$(P)$(R)$(ACQ_NAME)ConvArrayDataWvf$(RTM_CHAN)")
{
  field(DESC, "Current calibrated waveform $(ACQ_NAME)$(RTM_CHAN)")
  field(NELM, "1000")
  field(FTVL, "$(FTVL)")
  field(TSEL, "$(P)$(R)$(ACQ_NAME)RawArrayData.TIME")
  field(FLNK, "$(P)$(R)$(ACQ_NAME)ConvArrayData$(RTM_CHAN) PP")
  }

record(subArray,"$(P)$(R)$(ACQ_NAME)ConvArrayData$(RTM_CHAN)")
{
  field(DESC, "Current calibrated $(ACQ_NAME)")
#  field(SDIS, "$(P)$(R)PosCal-Sts CPP NMS")
#  field(DISV, "1")
  field(INP,  "$(P)$(R)$(ACQ_NAME)ConvArrayDataWvf$(RTM_CHAN) NPP NMS")
  field(TSEL, "$(P)$(R)$(ACQ_NAME)RawArrayData.TIME")
  field(MALM, "1000")
  field(FTVL, "$(FTVL)")
  field(FLNK, "$(P)$(R)$(ACQ_NAME)ConvArrayDataSeq$(RTM_CHAN)")
}

# Adjust NELM of subarray so clients get correct monitors when
# number os elements change
record(seq, "$(P)$(R)$(ACQ_NAME)ConvArrayDataSeq$(RTM_CHAN)"){
  field(DESC,"Get NORD from $(ACQ_NAME)Raw waveform")
  field(PINI,"YES")
  field(DOL1, "$(P)$(R)$(ACQ_NAME)RawArrayData.NORD NPP NMS")
  field(LNK1, "$(P)$(R)$(ACQ_NAME)ConvArrayData$(RTM_CHAN).NELM PP NMS")
  field(SELM, "All")
}

